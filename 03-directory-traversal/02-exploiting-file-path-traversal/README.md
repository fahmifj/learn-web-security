# Common obstacles to exploiting file path traversal vulnerabilities

If an application block/strips traversal sequences, it might be possible to bypass it using the following techniques.

## Lab: File path traversal, traversal sequences blocked with absolute path bypass


Example request url to fetch images
```
https://acf21f0d1e0928f0806865f60007004a.web-security-academy.net/image?filename=73.jpg
```

Original request

![16c413ef4535cec1d4d48e66261f34a2.png](./_resources/2daac8578d184f8f9b9fc7326ee0ff5d.png)

Modified request & intercept response

![0df6c47eb4cf63018c025eec0d3cf40a.png](./_resources/eb52fccdba344e5fb7cd28f94206328c.png)

Intercepted response

![ec4b02e20d7046c0dfe615de10602f82.png](./_resources/8048149be3bc49678ae2a973921febfe.png)


## Lab: File path traversal, traversal sequences stripped non-recursively

If the application filter/block a traversal sequences `../`, we can use the nested one `....//`, which will simply revert to `../`.

![dcc28cfed88b0b0bdea871bdb7e72b1c.png](./_resources/cf5e3eabf0c4423499f0f97d9def9a75.png)

blocked pattern `../`  
blocked pattern stripped by the apps `..[../]/` => `../`

![03567704bee2ab9b5672d98b01043912.png](./_resources/cd04beda93ea4f90b0b00280b198cf79.png)

## Lab: File path traversal, traversal sequences stripped with superfluous URL-decode

Browser uses a url encode and decode like
`%20` for a space, `%40` for @. Therefore, a superflous decode might used to bypass an application input filter.

![05716b209da08cdd6687e312cf315687.png](./_resources/b104f3c490a2418a82d60bab04abb13e.png)


![292453d112ad2fb4f01ae7afe9d62291.png](./_resources/32b98a6ebe21484984473caddfdf6b73.png)

Superflous decode

- `%25` = `%`  
- `%2f` = `/`
- `%252f` = `%2f` => `/`

## Lab: File path traversal, validation of start of path

Example request url:

```
https://ac1e1f671f42243b800c1527000400e7.web-security-academy.net/image?filename=/var/www/images/5.jpg
```
It requires `/var/www/images/` as base path

![72bdb334ce87eda2fa1b73d0cc4d1242.png](./_resources/a8c5ae492bd04336a0b29f3998101eb4.png)

In this case, it might be possible to just traverse back with suitable techniques 

```
/var/www/images/./etc/passwd
/var/www/images/....//....//....//etc/passwd
/var/www/images/....%25f....%25f....%25fetc/passwd
```

![595fada1c674c977b8f8638f80450753.png](./_resources/e98ac77e1057453c8a51159721fde98a.png)

![89584cd87eab3538690fa710aafbfbbd.png](./_resources/94bce51839f349c882f98d2fc286eb91.png)


## Lab: File path traversal, validation of file extension with null byte bypass

If a specific file extension is expected by the app, then it might be possible to terminate the required extension by using null byte.

![6e9e1739d1d0deb6016e461b7acb6769.png](./_resources/f9e36c75961e44e78e99900580f0dff5.png)